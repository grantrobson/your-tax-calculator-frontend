<html>

<head>
    <title>JavaScript TCR POC</title>

<style>
    p.one {
    border-style: solid;
    border-width: 5px;
    }

    h1.hidden {
    visibility: hidden;
    }
</style>


<script type="text/javascript">
    var map = new Map();

    function removeChildren(div) {
        var node = document.getElementById(div)
        while (node.hasChildNodes()) {
            node.removeChild(node.lastChild);
        }
    }

    // Update the id attribute fields of cloned row.
    function updateChildren(id, i) {
        var itm = document.getElementById(id);
        var cln = itm.cloneNode(true);
        var children = cln.children;

        cln.id = cln.id + "_" + i;
        for (c = 0; c < children.length; c++) {
            cur = children[c];
            if (cur.nodeType === 1 && cur.id) {
                cur.id = cur.id + "_" + i;
            }
        }

        containerDiv.appendChild(cln);

         var element = document.getElementById('number_entry_hidden_'+i);
         if (element != null) {
            var child = element.children;
            for (c = 0; c < child.length; c++) {
                cur = child[c];
                if (cur.nodeType === 1 && cur.id) {
                    cur.id = cur.id + "_" + i;
                }
            }
        }
    }

    function dynamicRadioButton(selectionType) {
        var questionData = getFromId(questionPos);
        var arrayLength = questionData.questionType.multipleChoiceOptions.length;

        // Remove all child nodes.
        removeChildren("containerDiv");

        // Create child nodes based on current question type.
        for (var i = 0; i < arrayLength; i++) {

            // Clone the associated input row based on type.
            updateChildren("row_ID_"+selectionType, i);

            // Obtain handle to the radio button.
            var radioButton = document.getElementById("row_"+selectionType+"_ID_"+i);
            // Set text label.
            var label = document.getElementById("row_label_"+selectionType+"_ID_"+i);
            label.innerHTML = questionData.questionType.multipleChoiceOptions[i].option;

            // Check if the button (checkbox or radio) was previously selected.
            if (map.get(questionData.questionType.multipleChoiceOptions[i].modelId) == "true") {
                radioButton.setAttribute("checked","checked");
            } else if (map.has(questionData.questionType.multipleChoiceOptions[i].modelId) && selectionType=="checkbox") {
                // Default the checkbox as checked and display the input number field.
                radioButton.setAttribute("checked","checked");
                show('number_entry_hidden_'+i);
            }

            // update the controls based on type.
            if (selectionType == 'radio') {
                radioButton.setAttribute("id", questionData.questionType.multipleChoiceOptions[i].modelId);
                radioButton.setAttribute("onClick", "toggleRadioButton(\""+questionData.questionType.multipleChoiceOptions[i].modelId+"\")");
            } else if (selectionType == "checkbox") {

                // Set the id of the number input field.
                var input = document.getElementById("row_number_"+selectionType+"_ID_"+i);
                input.setAttribute("id", questionData.questionType.multipleChoiceOptions[i].modelId + "_INPUT");

                if (map.has(questionData.questionType.multipleChoiceOptions[i].modelId)) {
                    input.setAttribute("value", map.get(questionData.questionType.multipleChoiceOptions[i].modelId));
                }
                // Override onClick.
                radioButton.setAttribute("onClick", "toggleCheckboxButton(\""+questionData.questionType.multipleChoiceOptions[i].modelId+"_INPUT\",\""+i+"\")");
            }
        }

        // Set the next onClick function based on the type of control.
        if (selectionType == "checkbox") {
          document.getElementById("MultipleChoiceNEXT").onclick = function() {
                    MultipleChoiceNEXT();
                };
        } else {
          document.getElementById("MultipleChoiceNEXT").onclick = function() {
                    NEXT();
                };
        }

        // TODO...this can be turned into a generic function for all question types!
        // Check if dynamic header should be added to question.
        if (questionData.questionType.headerDiv !== undefined) {
            removeChildren("dynamicHeaderMultipleChoice");
            var itm = document.getElementById(questionData.questionType.headerDiv);
            var cln = itm.cloneNode(true);
            var insertPoint = document.getElementById("dynamicHeaderMultipleChoice");
            insertPoint.appendChild(cln);
        }

    }
</script>

<script language=javascript type="text/javascript">
    var START_QUESTION = "1";
    var   AUTO_RENEWAL = "R";

    var questionPos = START_QUESTION;
    var stack = [];
    var dynamicControls = ["Boolean", "MultipleChoice",  "Decimal"];

    function toggleControls(toggle) {
        dynamicControls.forEach((item) => {
            if (toggle == "show") show(item); else hide(item);
        });
    }

    function canGoBack() {
        return(stack.length == 0 ? "true" : "false");
    }

    function BACK() {
        if (stack.length == 0) {
            questionPos = START_QUESTION;
        } else {
            questionPos = stack.pop();
        }
        toggleControls("hide");
        displayQuestion();
    }

    // TODO...EXTEND ERROR HANDLING.
    function resume(model) {
        hide("demo");
        map = new Map();
        questionPos = START_QUESTION;
        var tokens = model.split(",");
        tokens.forEach(token => {
         var data = token.split(":");
         map.set(data[0],data[1]);
         });
        toggleControls("hide");
        displayQuestion();
    }

    function getModelData() {
        // TODO...Return JSON response  + include stack.
        var dumpData = "";
        var first = 1;
        var append = "";

        map.forEach((value, key) => {
            if (first == 1) {
                first=0;
                append="";
            } else {
                append=",";
            }
            dumpData = dumpData + append + key+":"+value;
        });

        // TODO...create debug function
        var span = document.getElementById("dumpText"),
        text = document.createTextNode(dumpData);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);
        return(dumpData);
    }

    // TODO: Move to debug script
    function extractAPI() {
        var apiJson = buildSubmissionPostRequest();
        var span = document.getElementById("dumpText"),
        text = document.createTextNode(apiJson);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);
    }

    function getFromId(id) {
        var arrayLength = data().questions.length;
        for (var i = 0; i < arrayLength; i++) {
            if (data().questions[i].id == id) {
                return data().questions[i];
            }
        }
        alert("FAILED TO FIND!!!");
    }

    function toggleRadioButton(id) {
    var radio = document.getElementById(id);
        if (radio.checked == true) {
            map.set(id, "true");
        } else {
            map.set(id, "false");
        }
    }

    // Show/Hide the associated number input control.
    function toggleCheckboxButton(ida, row) {
        var inputField = document.getElementById("row_checkbox_ID_"+row);
        var row = "number_entry_hidden_"+row;
        if (inputField.checked == true) {
            show(row);
        } else {
            hide(row);
        }
    }

    // TODO..validation and error handling!
    function MultipleChoiceNEXT() {

        var questionData = getFromId(questionPos);
        var arrayLength = questionData.questionType.multipleChoiceOptions.length;

        // Cycle around associated checkbox input fields and check if ticked.
        for (var i = 0; i < arrayLength; i++) {
            // Obtain handle to checkbox.
            var inputField = document.getElementById("row_checkbox_ID_"+i);
            if (inputField.checked == true) {
                var element = document.getElementById(questionData.questionType.multipleChoiceOptions[i].modelId + "_INPUT")
                // Obtain the input value for the associated field and update map.
                var input = element.value;

                map.set(questionData.questionType.multipleChoiceOptions[i].modelId, input);
            } else {
                // Not ticked, remove from map.
                map.delete(questionData.questionType.multipleChoiceOptions[i].modelId);
            }
        }

        // Route to next question.
        stack.push(questionPos);
        var question = getFromId(questionPos);
        questionPos = question.questionType.nextQuestionId;
        displayQuestion();
    }

    // TODO...Add validation. Define in future ticket.
    function NEXT_DECIMAL() {
        stack.push(questionPos);
        var question = getFromId(questionPos);
        questionPos = question.questionType.nextQuestionId;

        var decimalInput = document.getElementById("DecimalInput").value;
        map.set(question.questionType.modelId, decimalInput+"");
        displayQuestion();
    }

    function NEXT(nextId) {
        var question = getFromId(questionPos);
        var arrayLength = question.questionType.multipleChoiceOptions.length;

        // TODO: This is temp code to handle Next button. Do not route to Next if no options selected.
        var enableNext=false;
        // Cycle around associated checkbox input fields and check if ticked.
        for (var i = 0; i < arrayLength; i++) {
            // Obtain handle to checkbox.
            var inputField = document.getElementById(question.questionType.multipleChoiceOptions[i].modelId).checked;
            // Check if the control is checked.
            if (inputField == true) {
                enableNext = true;
                break;
            }
        }

        if (enableNext == false) {
            alert(' Please select one of the options to continue.');
        } else {
            stack.push(questionPos);
            questionPos = question.questionType.nextQuestionId;
            displayQuestion();
        }
    }

    function YES() {
        stack.push(questionPos);
        var question = getFromId(questionPos);

        if (question.questionType.modelId !== "undefined") {
            map.set(question.questionType.modelId, "true");
        }

        questionPos =  question.questionType.yesNextQuestionId;
        displayQuestion();
    }

    function NO() {
        stack.push(questionPos);
        var question = getFromId(questionPos);

        if (question.questionType.modelId !== "undefined") {
            map.set(question.questionType.modelId, "false");
        }

        questionPos =  question.questionType.noNextQuestionId;
        displayQuestion();
    }

    function startDemo() {
        toggleControls();
        hide("demo");

        // Invoke the startup function and supply dummy data. This test data will run through complex set of questions.
        startup("D", false, "CS700100AD", "1/1/2017", "2/2/2017");
    }

    function initQuestion(question, control, header) {
        document.getElementById(header).innerHTML = question.question;
        toggleControls("hide");
        show(control);
    }

    function displayQuestion() {
        var question = getFromId(questionPos);

        // TODO: Move to debug function
        var trace = "Question:"+questionPos+"-"+question.questionType.type
        var span = document.getElementById("QuestionId");
        var text = document.createTextNode(trace);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);

        if (question.questionType.type == "JourneyCompleteAutoRenewal") {
            // This indicates end of journey for auto renewals!
            toggleControls("hide");
            hook("JourneyCompleteAutoRenewal");
            return;
        } else if (question.questionType.type == "JourneyComplete") {
            // This indicates end of journey for all complete renewal journeys where the  renewal is not auto!
            toggleControls("hide");
            hook("JourneyComplete");
            return;
        } else if (question.questionType.type == "Boolean") {
            initQuestion(question, 'Boolean', 'headerBoolean');
        } else if (question.questionType.type == "MultipleChoice") {
            initQuestion(question, 'MultipleChoice', 'headerMultipleChoice');
            dynamicRadioButton("radio");
        } else if (question.questionType.type == "MultipleChoiceWithNumber") {
            initQuestion(question, 'MultipleChoice', 'headerMultipleChoice');
            dynamicRadioButton("checkbox");
        } else if (question.questionType.type == "Decimal") {
            initQuestion(question, 'Decimal', 'headerDecimal');
            // Populate Decimal value from model if exists.
            var question = getFromId(questionPos);
            var decimalStore = map.get(question.questionType.modelId);
            if (decimalStore === undefined) {
                // Clear any previous entry in the field.
                document.getElementById('DecimalInput').value = ""
            }
            else if (decimalStore != "") {
                document.getElementById('DecimalInput').value = decimalStore;
            }

            // Toggle estimated-income checkbox if modelIdEstimatedIncome element defined in model.
            hide('estimatedIncomeDiv');
            if (question.questionType.modelIdEstimatedIncome !== undefined) {
                var estimatedIncome = map.get(question.questionType.modelIdEstimatedIncome);
                show('estimatedIncomeDiv');
                // Set the checked state based on model value.
                if (estimatedIncome == 'true') {
                    document.getElementById('estimatedIncomeValue').checked = true;
                } else {
                 document.getElementById('estimatedIncomeValue').checked = false;
                }
            }
        } else {
            alert('Failed to resolve the question type ' + question.questionType.type);
        }
    }

    // TODO: Currently hardwired.
    function buildSubmissionPostRequest() {

        // TODO...TEMP PLUMBING CODE. Drive the JSON result based on supplied NINO.
        var taxableBenefits = 0;
        var nino = map.get("nino");
        if (nino == "CS700100A") {
            taxableBenefits = 999;
        } else {
            taxableBenefits = 333;
        }

        var submission = {
          "renewalData": {
            "incomeDetails": {
              "taxableBenefits": taxableBenefits,
              "earnings": 20,
              "companyBenefits": 30,
              "seProfits": 40,
              "seProfitsEstimated": true
            },
            "incomeDetailsPY1": {
              "taxableBenefits": 10,
              "earnings": 20,
              "companyBenefits": 30,
              "seProfits": 40,
              "seProfitsEstimated": true
            },
            "certainBenefits": {
              "receivedBenefits": false,
              "incomeSupport": false,
              "jsa": false,
              "esa": false,
              "pensionCredit": false
            }
          },
          "otherIncome": {
            "otherHouseholdIncome": 100,
            "isOtherHouseholdIncomeEst": false
          },
          "otherIncomePY1": {
            "otherHouseholdIncome": 100,
            "isOtherHouseholdIncomeEst": false
          },
          "hasChangeOfCircs": false
        }
        return(JSON.stringify(submission));
    }

    function startup(renewalType, hasPartner, nino, endDate, startDate) {
        // Initialise globals.
        questionPos = START_QUESTION;
        stack = [];

        // Add all parameters to map.
        map.set("renewalType", renewalType);
        map.set("hasPartner", hasPartner);
        map.set("nino", nino);
        map.set("endDate", endDate);
        map.set("startDate", startDate);

        displayQuestion();
    }

    // Toggle estimatedIncome model value.
    function setEstimatedIncomeValue() {
        var questionData = getFromId(questionPos);
        var radio = document.getElementById('estimatedIncomeValue');

        if (radio.checked == true) {
            map.set(questionData.questionType.modelIdEstimatedIncome, "true");
        } else {
            map.set(questionData.questionType.modelIdEstimatedIncome, "false");
        }
    }

    // Resolve associated questions for renewal flow.
    function data() {

        var nino = map.get("nino");
        var renewalType = map.get("renewalType");

        // Auto renewal question.
        if (renewalType !== undefined && renewalType.toUpperCase() == AUTO_RENEWAL) {

            var autoRenewalJourney = {
                "formType":"AutoRenewal",

                "CreationData":"12/12/2017:10:13",

                "questions": [
                        {
                            "id": "1",
                            "question": "Do you need to report any changes to the details shown?",
                            "questionType": {
                              "type": "MultipleChoice",
                              "headerDiv": "auto-renewal-header",
                              "multipleChoiceOptions": [
                                {
                                  "option": "Yes",
                                  "modelId": "auto-renewal-yes"
                                },
                                {
                                  "option": "No",
                                  "modelId": "auto-renewal-no"
                                }
                              ],
                              "nextQuestionId": "2"
                            }
                        },
                        {
                            "id": "2",
                            "question": "Renewal complete",
                            "questionType": {
                              "type": "JourneyCompleteAutoRenewal"
                            }
                        }
                    ]
                };

            return(autoRenewalJourney);

        } else if (nino !== undefined && nino == "CS700100A") {

            var journey1 = {
                "formType":"JointApplicant",

                "CreationData":"12/12/2017:10:13",

                "questions": [
                      {
                        "id": "1",
                        "question": "Did you get any of these benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                        "questionType": {
                          "type": "Boolean",
                          "yesNextQuestionId": "2",
                          "noNextQuestionId": "3a",
                          "modelId": "renewalData.certainBenefits.receivedBenefits"
                        }
                      },
                      {
                        "id": "2",
                        "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                        "questionType": {
                          "type": "MultipleChoice",
                          "multipleChoiceOptions": [
                            {
                              "option": "Income Support",
                              "modelId": "renewalData.certainBenefits.incomeSupport"
                            },
                            {
                              "option": "Income-based Jobseeker's Allowance",
                              "modelId": "renewalData.certainBenefits.jsa"
                            }
                          ],
                          "nextQuestionId": "3a"
                        }
                      },
                      {
                        "id": "3a",
                        "question": "Journey Complete",
                        "questionType": {
                          "type": "JourneyComplete"
                        }
                      }
                    ]
                };
            return(journey1);
        } else {
            // Test questions for CSS developer to run through all question types.

            var myObj = {
            "formType":"JointApplicant",

            "CreationData":"12/12/2017:10:13",

            "questions": [
                  {
                    "id": "1",
                    "question": "Did you get any of these benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "11a",
                      "noNextQuestionId": "3a",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "11a",
                    "question": "How much did you receive in company benefits between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "Some more info on what this question is",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "2",
                      "modelId": "some-income-value",
                      "modelIdEstimatedIncome": "estimated-income"
                    }
                  },
                  {
                    "id": "3a",
                    "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoiceWithNumber",
                      "multipleChoiceOptions": [
                        {
                          "option": "Other Income Support",
                          "modelId": "otherBenefits.OtherIncome"
                        },
                        {
                          "option": "Other Income-based Jobseeker's Allowance",
                          "modelId": "otherBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "2"
                    }
                  },


                  {
                    "id": "2",
                    "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "3"
                    }
                  },
                  {
                    "id": "3",
                    "question": "Did your partner get any of these benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "4",
                      "noNextQuestionId": "5",
                      "modelId": "renewalData.certainBenefits.receivedBenefits" // TODO...DUPLICATE!
                    }
                  },
                  {
                    "id": "4",
                    "question": "Which of these benefits did your partner get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport-TODO-4"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance TODO 4",
                          "modelId": "renewalData.certainBenefits.jsa.TODO-4"
                        }
                      ],
                      "nextQuestionId": "5"
                    }
                  },
                  {
                    "id": "5",
                    "question": "Did you get any of these other benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Other Income Support \n\r - Other Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "6",
                      "noNextQuestionId": "7"
                    }
                  },
                  {
                    "id": "6",
                    "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Other Income Support",
                          "modelId": "otherBenefits.OtherIncome_TODO_1"
                        },
                        {
                          "option": "Other Income-based Jobseeker's Allowance",
                          "modelId": "otherBenefits.jsa_TODO_1"
                        }
                      ],
                      "nextQuestionId": "7"
                    }
                  },
                  {
                    "id": "7",
                    "question": "Were you employed at any time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "8",
                      "noNextQuestionId": "10"
                    }
                  },
                  {
                    "id": "8",
                    "question": "How much did you earn from all of your jobs as an employee between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "9",
                      "modelId": "otherIncome.otherHouseholdIncome",
                      "modelIdEstimatedIncome" : "otherIncome.otherHouseholdIncome.estimatedIncome"
                    }
                  },
                  {
                    "id": "9",
                    "question": "How much did you receive in company benefits between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "Some more info on what this question is",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "10",
                      "modelId": "TODO-QUESTION-9"
                    }
                  },
                  {
                    "id": "10",
                    "question": "Were you self employed at any time between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "This does not include renting out property or a room in your home.",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "11",
                      "noNextQuestionId": "12"
                      // TODO...IF NO MODEL ID THEN DO NOT STORE!
                    }
                  },
                  {
                    "id": "11",
                    "question": "How much self-employed profit did you make between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "If you made a loss, enter zero (eg, 0)",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "12",
                      // TODO...SORT THIS OUT!!!
                      "allowEstimate": true,
                      "modelId": "otherIncome.selfEmployedProfit",
                      "estimateModelId": "otherIncome.isSelfEmployedProfitEst"
                    }
                  },
                  {
                    "id": "12",
                    "question": "Did you get any of these taxable benefits at the time between 6 April 2014 to 5 April 2015? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "13",
                      "noNextQuestionId": "14"
                    }
                  },
                  {
                    "id": "13",
                    "question": "How much did you receive for all your taxable benefits between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "14",
                    "modelId": "TODO_Q-14"
                    }
                  },
                  {
                    "id": "14",
                    "question": "Did your partner get any of these taxable benefits at the time between 6 April 2014 to 5 April 2015? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "15",
                      "noNextQuestionId": "16"
                    }
                  },
                  {
                    "id": "15",
                    "question": "How much did your partner receive for all your taxable benefits between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "16",
                      "modelId": "TODO_Q-15"
                    }
                  },
                  {
                    "id": "16",
                    "question": "Did you get any of these benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "17",
                      "noNextQuestionId": "18",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "17",
                    "question": "Which of these benefits did you get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "18"
                    }
                  },
                  {
                    "id": "18",
                    "question": "Did your partner get any of these benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "19",
                      "noNextQuestionId": "20",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "19",
                    "question": "Which of these benefits did your partner get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "20"
                    }
                  },
                  {
                    "id": "20",
                    "question": "Did you get any of these other benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Other Income Support \n\r - Other Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "21",
                      "noNextQuestionId": "22"
                    }
                  },
                  {
                    "id": "21",
                    "question": "Which of these benefits did you get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                //      "type": "MultipleChoiceWithNumber", TODO
                      "multipleChoiceOptions": [
                        {
                          "option": "Other Income Support",
                          "modelId": "otherBenefits.OtherIncome_TODO_2"
                        },
                        {
                          "option": "Other Income-based Jobseeker's Allowance",
                          "modelId": "otherBenefits.jsa_TODO_2"
                        }
                      ],
                      "nextQuestionId": "22"
                    }
                  },
                  {
                    "id": "22",
                    "question": "Were you employed at any time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "23",
                      "noNextQuestionId": "25"
                    }
                  },
                  {
                    "id": "23",
                    "question": "How much did you earn from all of your jobs as an employee between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "24",
                      "modelId": "otherIncome.otherHouseholdIncome_TODO_DUPLICATE"
                    }
                  },
                  {
                    "id": "24",
                    "question": "How much did you receive in company benefits between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "Some more info on what this quesiton is",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "25",
                      "modelId": "TODO.QUESTION.25"
                    }
                  },
                  {
                    "id": "25",
                    "question": "Were you self employed at any time between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "This does not include renting out property or a room in your home.",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "26",
                      "noNextQuestionId": "27"
                    }
                  },
                  {
                    "id": "26",
                    "question": "How much self-employed profit did you make between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "If you made a loss, enter zero (eg, 0)",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "27",
                      "allowEstimate": true,
                      "modelId": "otherIncome.selfEmployedProfit_TODO_DUPLICATE",
                      "estimateModelId": "otherIncome.isSelfEmployedProfitEst"
                    }
                  },
                  {
                    "id": "27",
                    "question": "Did you get any of these taxable benefits at the time between 6 April 2015 to 5 April 2016? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      // TODO...NO MODEL ID!!! IF NO ID THEN STORE NOTHING!!!
                      "type": "Boolean",
                      "yesNextQuestionId": "28",
                      "noNextQuestionId": "29"
                    }
                  },
                  {
                    "id": "28",
                    "question": "How much did you receive for all your taxable benefits between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "29",
                      "modelId": "TODO.QUESTION.29"
                    }
                  },
                  {
                    "id": "29",
                    "question": "Did your partner get any of these taxable benefits at the time between 6 April 2015 to 5 April 2016? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "30",
                      "noNextQuestionId": "31"
                    }
                  },
                  {
                    "id": "30",
                    "question": "How much did your partner receive for all your taxable benefits between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "31",
                      "modelId": "TODO.QUESTION.31"
                    }
                  },
                    {
                    "id": "31",
                    "question": "The end of the demo screens",
                    "questionType": {
                      "type": "JourneyComplete"
                    }
                  }
                ]
            }
        }

        return(myObj);

    }
</script>

    <script type="text/javascript">

   function hide(id) {
       var e = document.getElementById(id);
        e.style.display = 'none';
   }

   function show(id) {
       var e = document.getElementById(id);
            e.style.display = 'block';
   }

</script>

<script>

    function hook(journeyOutcomeStatus) {
        // TODO...Hardwired OS functions.

        var nino = map.get("nino");
        var isEstimatedIncome = false;
        if (nino == "CS700100A") {
            isEstimatedIncome = true;
        }

        var payload = {
            "journeyOutcomeStatus":journeyOutcomeStatus,
            "isEstimatedIncome":isEstimatedIncome
        };

        var response = JSON.stringify(payload);
        // TODO...debug function. Output the callback response in order for ticket to be tested by QA.
        var span = document.getElementById("dumpText"),
        text = document.createTextNode(response);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);


        // TODO...extend to supply a JSON object and not individual params.
        // IOS callback.
        try {
            window.webkit.messageHandlers.iosmessagehandler.postMessage(response);
        } catch(err) {}

        // Windows callback.
        try {
            window.external.notify(response);
        } catch(err) {}

        // Android callback.
        try {
            Android.hook(response);
        } catch(err) {}
    }

</script>


</head>

<body>

<h1>Tax-Credit-Renewal JavaScript Application</h1>


<!-- MultipleChoice -->
<div id="MultipleChoice" style="display: none;">
    <div id="dynamicHeaderMultipleChoice"></div>
    <b><p id="headerMultipleChoice"></p></b>
    <div>
        <div id="containerDiv"></div>
    </div>
    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="NEXT" id="MultipleChoiceNEXT" onClick="javascript:NEXT()">
</div>


<div style="display: none;">
    <div id="row_ID_checkbox">
        <label id="row_label_checkbox_ID"></label>
        <input type="checkbox" id="row_checkbox_ID">

        <div id="number_entry_hidden" style="display: none;">
            <input type="number" id="row_number_checkbox_ID" value="">
        </div>
    </div>


    <div id="row_ID_radio">
        <label id="row_label_radio_ID"></label>

        <!-- TODO -->
        <input type="checkbox" id="row_radio_ID">
    </div>
</div>

<!-- Boolean -->
<div id="Boolean" style="display: none;">
    <p id="headerBoolean"></p>
    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="YES" onClick="javascript:YES()">
    <input type="button" value="NO" onClick="javascript:NO()">
</div>

<!-- Decimal Input -->
<div id="Decimal" style="display: none;">
    <p id="headerDecimal"></p>
    <input type="number" id="DecimalInput">
    <br>

    <!-- Only displayed if model defines modelIdEstimatedIncome attribute. -->
    <div id="estimatedIncomeDiv" style="display: none;">
        <label>Estimated Income</label>
        <input type="checkbox" id="estimatedIncomeValue" onClick="javascript:setEstimatedIncomeValue()">
    </div>

    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="NEXT" onClick="javascript:NEXT_DECIMAL()">

</div>

<!-- Dynamic header DIV's -->
<div style="display: none;">

    <div id="auto-renewal-header">

        <!-- CSS DEV: Please see example layout https://tax-credits-renewals-prototype.herokuapp.com/iterate-2016/sprint-27/auto-joint/do_you_want_to_renew_now -->
        <h2><span>Your claim will be automatically renewed unless you need to report any changes</span></h2>
        <h3><span>Check the details in your renewal pack for your claim between 6 April 2016 and 5 April 2017.</span></h3>
        <br>
        <span>Your renewal pack should arrive by 30 June 2016. </span>
        <br>
        <br>
    </div>
</div>


<div id="demo">
    <input type="button" value="Enter app" onClick="javascript:startDemo()">
</div>

<br>
<br>


<p class="one">Tools - Please note below section is for debug support.</p>
<br>
<div id="Question Debug Trace">
    <b><span>Question Details</span></b>
    <br>
    <span id="QuestionId"></span>
</div>
<br>


<input type="button" value="Initialise model" onClick="javascript:resume('nino:CS123456B,renewalData.certainBenefits.incomeSupport:true,otherIncome.otherHouseholdIncome:1234.54')">
<input type="button" value="Extract Model" onClick="javascript:getModelData()">
<input type="button" value="API" onClick="javascript:extractAPI()">

<div id="dumpDiv">
    <b><span>Debug</span></b>
    <br><br>
    <span id="dumpText"></span>
</div>

</body>
</html>
