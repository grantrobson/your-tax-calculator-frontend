<script language=javascript type="text/javascript">

    // Resolve associated questions for renewal flow and initialize HTML based on supplied renewal type.
    var builtData="";
    function data() {

        if (builtData) {
            return(builtData);
        }

        ////////////////////////////////////////////////////////////////////////////////
        // QUESTIONS START

        var jointApplicant = [
            {
                "id": "Partner benefits & income intro",
                "group": "partner",
                "question": "Part [REPLACE_X]: Your partner's benefits & income intro",
                "questionType": {
                  "type": "Continue",
                  "questionFooterDiv": "Partner benefits & income intro",
                  "nextQuestionId": "Did partner get any untaxed benefits?"
                }
            },

            {
                "id": "Did partner get any untaxed benefits?",
                "group": "partner",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Did partner get any untaxed benefits?",
                "questionType": {
                  "type": "Boolean",
                    "questionFooterDiv": "did-you-get-any-untaxed-benefits",
                    "yesNextQuestionId": "Which untaxed benefits did partner get",
                    "noNextQuestionId": "Was partner employed?",
                    "modelId": "partner.certainBenefits.receivedBenefits",

                    "answerNo": {
                        "questionIds": [
                            "Which untaxed benefits did partner get",
                             "Does partner still get this"
                        ]
                    }
                }
            },


                {
                    "id": "Which untaxed benefits did partner get",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Which untaxed benefits did your partner get?",
                    "questionType": {

                        "type": "MultipleChoice",
                        "multipleChoiceOptions": [
                            {
                                "option": "Income-based Jobseeker\'s Allowance",
                                "modelId": "partner.certainBenefits.jsa",
                                "questionId": "jobseeker"
                            },
                            {
                                "option": "Income-related Employment and Support Allowance",
                                "modelId": "partner.certainBenefits.esa",
                                "questionId": "support_allowance"
                            },
                            {
                                "option": "Income Support",
                                "modelId": "partner.certainBenefits.incomeSupport",
                                "questionId": "income_support"
                            },
                            {
                                "option": "Pension Credit",
                                "modelId": "partner.certainBenefits.pensionCredit",
                                "questionId": "pension_credit"
                            }
                        ],
                        "nextQuestionId": "Does partner still get this"
                        }
                    },
                    {
                        "id": "Does partner still get this",
                        "group": "partner",
                        "previousQuestionOption" : "Which untaxed benefits did partner get",

                        "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Does your partner still get this ",
                        "questionType": {
                          "type": "Boolean",
                          "yesNextQuestionId": "Did you get any other household income",
                          "noNextQuestionId": "Was partner employed?",
                          "modelId": "partner.certainBenefits.Does partner still get this benefit"
                        }
                    },

                {
                    "id": "Was partner employed?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Was your partner employed as an employee at any time between [DATE_A] and [DATE_B]?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "How much employed income did partner get?",
                      "noNextQuestionId": "Was partner self-employed?",
                      "modelId": "partner.incomeDetails.Was partner employed",

                        "answerNo": {
                            "questionIds": [
                                "How much employed income did partner get?",
                                 "Did partner get any company benefits?",
                                 "How much company benefit did partner get?"
                            ]
                        }

                    }
                },

                {
                    "id": "How much employed income did partner get?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>How much did your partner earn from all jobs as an employee between [DATE_A] and [DATE_B]?",
                    "questionType": {
                        "type": "Decimal",
                        "questionFooterDiv": "let-us-know-how-much-your-partner-earned",
                        "nextQuestionId": "Did partner get any company benefits?",
                        "modelId": "partner.incomeDetails.earnings"
                    }
                },

                {
                    "id": "Did partner get any company benefits?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Did your partner receive company benefits between [DATE_A] and [DATE_B]?",
                    "questionType": {
                        "type": "Boolean",
                        "questionFooterDiv": "Did partner get any company benefits?",
                        "yesNextQuestionId": "How much company benefit did partner get?",
                        "noNextQuestionId": "Was partner self-employed?",
                        "modelId": "partner.incomeDetails.Did partner get any company benefits",
                        "answerNo": {
                            "questionIds": [
                                 "How much company benefit did partner get?"
                            ]
                        }
                    }
                },

              {
                "id": "How much company benefit did partner get?",
                "group": "partner",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>How much did your partner receive in company benefits between [DATE_A] and [DATE_B]?",
                "questionType": {
                  "type": "Decimal",
                  "nextQuestionId": "Was partner self-employed?",
                  "modelId": "partner.incomeDetails.companyBenefits"
                }
              },

                {
                    "id": "Was partner self-employed?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Was your partner self-employed at any time between [DATE_A] and [DATE_B]?",
                    "questionType": {
                        "type": "Boolean",
                        "questionFooterDiv": "renting-does-not-include-rent-a-room-scheme",
                        "yesNextQuestionId": "Did partner make profit from self-employment?",
                        "noNextQuestionId": "Did partner get any taxable benefits?",
                        "modelId": "partner.incomeDetails.Was partner self-employed",
                        "answerNo": {
                            "questionIds": [
                                 "Did partner make profit from self-employment?",
                                 "Is partner self-employment loss estimated?",
                                 "How much profit did partner make from self-employment?",
                                 "Is partner self-employment profit estimated?"
                            ]
                        }

                    }
                },

                {
                    "id": "Did partner make profit from self-employment?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Did your partner make a profit from their self-employment between [DATE_A] and [DATE_B]?",
                    "questionType": {
                        "type": "Boolean",
                        "yesNextQuestionId": "How much profit did partner make from self-employment?",
                        "noNextQuestionId": "Is partner self-employment loss estimated?",
                        "modelId": "partner.incomeDetails.Did partner make profit from self-employment?",
                        "answerNo": {
                            "questionIds": [
                                 "How much profit did partner make from self-employment?",
                                 "Is partner self-employment profit estimated?"
                            ]
                        }

                    }
                },

                {
                    "id": "Is partner self-employment loss estimated?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Is your partner's self-employment loss estimated?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "Did partner get any taxable benefits?",
                      "noNextQuestionId": "Did partner get any taxable benefits?",
                      "modelId": "partner.incomeDetails.self_employed_loss_is_estimated"
                    }
                },

                {
                    "id": "How much profit did partner make from self-employment?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>How much self-employed profit did your partner make between [DATE_A] and [DATE_B]?",
                    "questionType": {
                    "type": "Decimal",
                        "nextQuestionId": "Is partner self-employment profit estimated?",
                        "modelId": "partner.incomeDetails.seProfits"
                    }
                },

                {
                    "id": "Is partner self-employment profit estimated?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Is your partner's self-employment profit estimated?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "Did partner get any taxable benefits?",
                      "noNextQuestionId": "Did partner get any taxable benefits?",
                      "modelId": "partner.incomeDetails.self_employed_profit_is_estimated"
                    }
                },

                {
                    "id": "Did partner get any taxable benefits?",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>Did your partner get any of these benefits between [DATE_A] and [DATE_B]?",
                    "questionType": {
                      "type": "Boolean",
                      "questionFooterDiv": "Did partner get any taxable benefits?",
                      "yesNextQuestionId": "Select partner taxable benefits and enter amount",
                      "noNextQuestionId": "Did you get any other household income",
                      "modelId": "partner.Did partner get any taxable benefits",

                        "answerNo": {
                            "questionIds": [
                                 "Select partner taxable benefits and enter amount"
                            ]
                        }

                    }
                },

                {
                    "id": "Select partner taxable benefits and enter amount",
                    "group": "partner",
                    "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your partner’s benefits and income</span>What benefits did your partner get between [DATE_A] and [DATE_B]?",
                    "questionType": {
                    "type": "MultipleChoiceWithNumber",
                        "questionFooterDiv": "Select partner taxable benefits and enter amount",
                        "multipleChoiceOptions": [
                            {
                                "option": "Bereavement Allowance",
                                "question": "How much Bereavement Allowance did your partner get?",
                                "modelId": "partner.taxableBenefits.bereavement_allowance",
                                "questionId": "bereavement_allowance"
                            },
                            {
                                "option": "Carer's Allowance",
                                "question": "How much Carer’s Allowance did your partner get?",
                                "modelId": "partner.taxableBenefits.carer_allowance",
                                "questionId": "carer_allowance"
                            },
                            {
                                "option": "Contribution-based Jobseeker's Allowance",
                                "question": "How much contribution-based Jobseeker’s Allowance did your partner get?",
                                "modelId": "partner.taxableBenefits.contribution_based_jobseeker_allowance",
                                "questionId": "contribution_based_jobseeker_allowance"
                            },
                            {
                                "option": "Contribution-based Employment and Support Allowance",
                                "question": "How much contribution-based Employment and Support Allowance did your partner get?",
                                "modelId": "partner.taxableBenefits.contribution_based_employment_and_support_allowance",
                                "questionId": "contribution_based_employment_and_support_allowance"
                            },
                            {
                                "option": "Incapacity Benefit",
                                "question": "How much Incapacity Benefit did your partner get??",
                                "modelId": "partner.taxableBenefits.incapacity_benefit",
                                "questionId": "incapacity_benefit"
                            }
                        ],
                    "nextQuestionId": "Did you get any other household income"
                    }
                }
            ];


        var startQuestions = [
            {
                "id": "confirm-pack-receipt",
                "question": "Your renewal pack",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "confirm-pack-receipt",
                    "yesNextQuestionId": "Completing review message",
                    "noNextQuestionId": "pack-not-received",
                    "modelId": "confirm-pack-receipt"
                }
            },
            {
                "id": "pack-not-received",
                "question": "You have not received your renewal pack yet",
                "questionType": {
                    "type": "Continue",
                    "nextButtonText": "Return to your tax credits",
                    "backButtonHidden": true,
                    "questionFooterDiv": "pack-not-received",
                    "nextQuestionId": "journey-complete",
                    "modelId": "pack-not-received"
                }
            },
            {
                "id": "Completing review message",
                "question": "Completing your declaration",
                "questionType": {
                    "type": "Continue",
                    "questionFooterDiv": "Completing review message",
                    "nextQuestionId": "Benefits & Income - intro"
                }
            },
            {
                "id": "journey-complete",
                "question": "completed journey",
                "questionType": {
                    "type": "JourneyComplete"
                }
            }
        ];


        var singleApplicant = [

            {
                "id": "Benefits & Income - intro",
                "group": "benefits-and-income",
                "question": "Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>",
                "questionType": {
                  "type": "Continue",
                  "questionFooterDiv": "part-1-your-benefits-and-income",
                  "nextQuestionId": "Did you get any untaxed benefits"
                }
            },
//====================================================================
// Benefits and income, maps to CERTAIN-BENEFITS!
            {
                "id": "Did you get any untaxed benefits",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span> Did you get any of these benefits for the whole time between [DATE_A] and [DATE_B]?",
                "section": "CERTAIN-BENEFITS",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "did-you-get-any-untaxed-benefits",
                    "yesNextQuestionId": "Which untaxed benefit did you get",
                    "noNextQuestionId": "Were you employed",
                    "modelId": "certainBenefits.receivedBenefits",
                    "answerNo": {
                        "questionIds": [
                            "Which untaxed benefit did you get",
                             "Do you still get this benefit",
                        ]
                    }
                }
            },

            {
                "id": "Which untaxed benefit did you get",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Which did you get for the whole time between [DATE_A] to [DATE_B]?",
                "section": "CERTAIN-BENEFITS",
                "questionType": {
                "type": "MultipleChoice",
                "multipleChoiceOptions": [
                    {
                    "option": "Income-based Jobseeker\'s Allowance",
                    "modelId": "certainBenefits.jsa",
                    "questionId": "jobseeker"
                    },
                    {
                    "option": "Income-related Employment and Support Allowance",
                    "modelId": "certainBenefits.esa",
                    "questionId": "support_allowance"
                    },
                    {
                    "option": "Income Support",
                    "modelId": "certainBenefits.incomeSupport",
                    "questionId": "income_support"
                    },
                    {
                    "option": "Pension Credit",
                    "modelId": "certainBenefits.pensionCredit",
                    "questionId": "pension_credit"
                    }
                ],
                "nextQuestionId": "Do you still get this benefit"
                }
            },

            {
                "id": "Do you still get this benefit",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Do you still get ",
                "section": "CERTAIN-BENEFITS",
                "previousQuestionOption" : "Which untaxed benefit did you get",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "ROUTING QUESTION DECISION",
                    "noNextQuestionId": "Were you employed",
                    "modelId": "certainBenefits.Do you still get this benefit",
                    "answerYes": {
                        "questionIds": [
                            "Were you employed",
                            "How much employed income",
                            "Did you get any company benefits",
                            "How much company benefit",
                            "Were you self employed",
                            "How much employed income",
                            "Did you get any company benefits",
                            "How much company benefit",
                            "Did you make a profit from self-employment",
                            "Is the self-employed loss estimated",
                            "How much profit from self-employment",
                            "Is the self-employed profit estimated",
                            "Select taxable benefits and enter amount"
                        ]
                    }
                }
            },

//====================================================================
// Other household income. OTHER-INCOME

            {
                "id": "Did you get any other household income",
                "group": "household-income",
                "question": "Part [REPLACE_X]: Other household income<br><p>Did you [PARTNER_DETAILS]get any of these sources of income between <nobr>[DATE_A]</nobr> and <nobr>[DATE_B]?</nobr></p>",
                "section":"OTHER-INCOME",
                "questionType": {
                  "type": "Boolean",
                  "questionFooterDiv": "Other household income",

                  "yesNextQuestionId": "Select other income sources & enter amount",
                  "noNextQuestionId": "Did you get any income from property rental",
                  "modelId": "otherIncome.Did you get any other household income",

                    "answerNo": {
                        "questionIds": [
                             "Select other income sources & enter amount",
                             "Are any of the income amounts estimated"

                        ]
                    }

                }
            },

            {
                "id": "Select other income sources & enter amount",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>What sources of income did you [PARTNER_DETAILS]get between between [DATE_A] to [DATE_B]?",
                "section":"OTHER-INCOME",
                "questionType": {
                "type": "MultipleChoiceWithNumber",
                    "multipleChoiceOptions": [
                    {
                        "option": "Savings, investments and dividends",
                        "question" : "How much income from savings, investments and dividends did you get?",
                        "modelId": "otherIncome.saving_investment_dividend",
                        "questionId": "saving_investment_dividend"
                    },
                    {
                        "option": "Pensions",
                        "question" : "How much income from pensions did you get?",
                        "modelId": "otherIncome.pensions",
                        "questionId": "pensions"
                    },
                    {
                        "option": "Trusts, settlements or estates",
                        "question" : "How much income from trusts, settlements or estates did you get?",
                        "modelId": "otherIncome.trusts_settlements_or_estates",
                        "questionId": "trusts_settlements_or_estates"
                    },
                    {
                        "option": "Foreign income",
                        "question" : "How much foreign income did you get?",
                        "modelId": "otherIncome.foreign_income",
                        "questionId": "foreign_income"
                    },
                    {
                        "option": "Notional income",
                        "question" : "How much notional income did you get?",
                        "modelId": "otherIncome.notional_income",
                        "questionId": "notional_income"
                    }
                ],
                "nextQuestionId": "Are any of the income amounts estimated"
                }
            },


            {
                "id": "Are any of the income amounts estimated",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>Are any of your sources of income amounts estimated?",
                "section":"OTHER-INCOME",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "are-any-of-the-income-amounts-estimated",
                    "yesNextQuestionId": "Did you get any income from property rental",
                    "noNextQuestionId": "Did you get any income from property rental",
                    "modelId": "otherIncome.isOtherHouseholdIncomeEst"
                }
            },

            {
                "id": "Did you get any income from property rental",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>Did you get [PARTNER_DETAILS]any income between [DATE_A] and [DATE_B] from renting out property?",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "Did you get any income from property rental",
                    "yesNextQuestionId": "Did you make a profit from property rental",
                    "noNextQuestionId": "ROUTING DECISION COC", //"Report any changes",
                    "modelId": "otherIncome.Did you get any income from property rental",

                    "answerNo": {
                        "questionIds": [
                             "Did you make a profit from property rental",
                             "Is property rental loss estimated",
                             "Property rental profit - enter amount",
                             "Is property rental profit estimated"
                        ]
                    }

                }
            },


            {
                "id": "Did you make a profit from property rental",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>Did you [PARTNER_DETAILS]make a profit from renting out property between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "Property rental profit - enter amount",
                    "noNextQuestionId": "Is property rental loss estimated",
                    "modelId": "otherIncome.Did you make a profit from property rental",

                    "answerNo": {
                        "questionIds": [
                             "Property rental profit - enter amount",
                             "Is property rental profit estimated"
                        ]
                        }
                }
            },

            {
                "id": "Is property rental loss estimated",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>Is the loss from renting out property an estimate?",
                "questionType": {
                  "type": "Boolean",
                  "yesNextQuestionId": "ROUTING DECISION COC",
                  "noNextQuestionId": "ROUTING DECISION COC",
                  "modelId": "otherIncome.rental_loss_is_estimated"
                }
            },

            {
                "id": "Property rental profit - enter amount",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>How much profit did you [PARTNER_DETAILS]make from renting out property between [DATE_A] and [DATE_B]?",
                "questionType": {
                  "type": "Decimal",
                  "nextQuestionId": "Is property rental profit estimated",
                  "modelId": "otherIncome.profit_from_property"
                }
            },

            {
                "id": "Is property rental profit estimated",
                "group": "household-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Other household income</span>Is the profit from renting out property an estimate?",
                "questionType": {
                  "type": "Boolean",
                  "yesNextQuestionId": "ROUTING DECISION COC",
                  "noNextQuestionId": "ROUTING DECISION COC",
                  "modelId": "otherIncome.rental_profit_is_estimated"
                }
            },


            // Decision!
            {
                "id": "ROUTING DECISION COC",
                "question": "Routing decision function",
                "questionType": {
                  "type": "RoutingDecision",
                    "JOINT_ROUTE": "Report any changes",
                    "JOINT_D2_ROUTE": "Benefits & Income - intro", // Cycle to collect PY
                    "OTHER_ROUTE": "Report any changes"
                }
            },

//====================================================================
// Report changes
// NOTE: NO MODEL ID FOR THIS QUESTION. ALWAYS CLEARED AND USER HAS TO RE-SELECT. See coc.report-yes which is the global flag.

            {
                "id": "Report any changes",
                "question": "Part [REPLACE_Y]: Report any changes",
                "questionType": {
                  "type": "Boolean",
                  "questionFooterDiv": "report-any-changes",
                  "yesNextQuestionId": "Native-route-to-CoC",
                  "noNextQuestionId": "summary-screen"
                }
            },

            {
                "id": "Native-route-to-CoC",
                "question": "Route to change Of Circumstance",
                "questionType": {
                  "type": "RouteToChangeOfCircumstance"
                }
            },
            {
                "id": "Native-submit-renewal",
                "question": "Submit the renewal",
                "questionType": {
                  "type": "SubmitRenewal"
                }
            },
            {
                "id": "save-and-exit",
                "question": "SaveAndComeBackLater",
                "questionType": {
                  "type": "SaveAndComeBackLater"
                }
            },
            {
                "id": "summary-screen",
                "question": "N/A",
                "questionType": {
                  "type": "Summary"
                }
            },

//====================================================================
// Employment!

            {
                "id": "Were you employed",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Were you employed as an employee at any time between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "How much employed income",
                    "noNextQuestionId": "Were you self employed",
                    "modelId": "incomeDetails.Were you employed",

                    "answerNo": {
                        "questionIds": [
                            "How much employed income",
                            "Did you get any company benefits",
                            "How much company benefit"
                        ]
                    }

                }
            },

            {
                "id": "How much employed income",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>How much did you earn from all of your jobs as an employee between [DATE_A] and [DATE_B]?",
                "questionType": {
                  "type": "Decimal",
                  "questionFooterDiv": "let-us-know-how-much-you-have-earned",
                  "nextQuestionId": "Did you get any company benefits",
                  "modelId": "incomeDetails.earnings"
                }
            },
                {
                "id": "Did you get any company benefits",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Did you receive company benefits between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "How much company benefit",
                    "noNextQuestionId": "Were you self employed",
                    "modelId": "incomeDetails.Did you get any company benefits",

                    "answerNo": {
                        "questionIds": [
                            "How much company benefit"
                        ]
                    }

                }
            },

            {
                "id": "How much company benefit",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>How much did you receive in company benefits between [DATE_A] and [DATE_B]?",
                "questionType": {
                  "type": "Decimal",
                  "nextQuestionId": "Were you self employed",
                  "modelId": "incomeDetails.companyBenefits"
                }
            },
            {
                "id": "Were you self employed",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Were you self-employed at any time between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "renting-does-not-include-rent-a-room-scheme",
                    "yesNextQuestionId": "Did you make a profit from self-employment",
                    "noNextQuestionId": "Did you get any taxable benefits",
                    "modelId": "incomeDetails.Were you self employed",
                    "answerNo": {
                        "questionIds": [
                            "Did you make a profit from self-employment",
                            "Is the self-employed loss estimated",
                            "How much profit from self-employment",
                            "Is the self-employed profit estimated"
                        ]
                    }
                }
            },
            {
                "id": "Did you make a profit from self-employment",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Did you make a profit from your self-employment between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "How much profit from self-employment",
                    "noNextQuestionId": "Is the self-employed loss estimated",
                    "modelId": "incomeDetails.Did you make a profit from self-employment",          // NO, then set renewalData.employee.self-employment-profit to 0
                    "answerNo": {
                        "questionIds": [
                            "How much profit from self-employment",
                            "Is the self-employed profit estimated"
                        ]
                    }
                }
            },
            {
                "id": "Is the self-employed loss estimated",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Is your self-employed loss an estimate?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "Did you get any taxable benefits",
                    "noNextQuestionId": "Did you get any taxable benefits",
                    "modelId": "incomeDetails.self_employed_loss_is_estimated"
                }
            },

            {
                "id": "How much profit from self-employment",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>How much self-employed profit did you make between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Decimal",
                    "nextQuestionId": "Is the self-employed profit estimated",
                    "modelId": "incomeDetails.seProfits",
                    "answerNo": {
                        "questionIds": [
                            "Is the self-employed profit estimated"
                        ]
                    }
                }
            },

            {
                "id": "Is the self-employed profit estimated",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Is your self-employed profit amount an estimate?",
                "questionType": {
                    "type": "Boolean",
                    "yesNextQuestionId": "Did you get any taxable benefits",
                    "noNextQuestionId": "Did you get any taxable benefits",
                    "modelId": "incomeDetails.self_employed_profit_is_estimated"
                }
            },


            {
                "id": "ROUTING QUESTION DECISION",
                "question": "Routing decision",
                "questionType": {
                  "type": "RoutingDecision",
                    "JOINT_ROUTE": "Partner benefits & income intro",
                    "OTHER_ROUTE": "Did you get any other household income"
                }
            },

// *** 1st applicant taxable benefits - NO ANSWER - route to "Did you get any other household income"
            {
                "id": "Did you get any taxable benefits",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>Did you get any of these benefits between [DATE_A] and [DATE_B]?",
                "questionType": {
                    "type": "Boolean",
                    "questionFooterDiv": "Did you get any taxable benefits",
                    "yesNextQuestionId": "Select taxable benefits and enter amount",
                    "noNextQuestionId": "ROUTING QUESTION DECISION",
                    "modelId": "renewalData.Did you get any taxable benefits",
                    "answerNo": {
                        "questionIds": [
                            "Select taxable benefits and enter amount"
                        ]
                    }
                }
            },

            {
                "id": "Select taxable benefits and enter amount",
                "group": "benefits-and-income",
                "question": "<span class='pre-header'>Part [REPLACE_X] of [REPLACE_Y]: Your benefits and income</span>What benefits did you get between [DATE_A] and [DATE_B]?",
                "questionType": {
                  "type": "MultipleChoiceWithNumber",
                  "multipleChoiceOptions": [
                    {
                      "option": "Bereavement Allowance",
                      "question": "How much Bereavement Allowance did you get?",
                      "modelId": "taxableBenefits.bereavement_allowance",
                      "questionId": "bereavement_allowance"
                    },
                    {
                      "option": "Carer's Allowance",
                      "question": "How much Carer’s Allowance did you get?",
                      "modelId": "taxableBenefits.carer_allowance",
                      "questionId": "carer_allowance"
                    },
                    {
                      "option": "Contribution-based Jobseeker's Allowance",
                      "question": "How much contribution-based Jobseeker’s Allowance did you get?",
                      "modelId": "taxableBenefits.contribution_based_jobseeker_allowance",
                      "questionId": "contribution_based_jobseeker_allowance"
                    },
                    {
                      "option": "Contribution-based Employment and Support Allowance",
                      "question": "How much contribution-based Employment and Support Allowance did you get?",
                      "modelId": "taxableBenefits.contribution_based_employment_and_support_allowance",
                      "questionId": "contribution_based_employment_and_support_allowance"
                    },
                    {
                      "option": "Incapacity Benefit",
                      "question": "How much Incapacity Benefit did you get??",
                      "modelId": "taxableBenefits.incapacity_benefit",
                      "questionId": "incapacity_benefit"
                    }
                  ],
                  "nextQuestionId": "ROUTING QUESTION DECISION",
                }
            }
        ];

        // QUESTIONS END
        ////////////////////////////////////////////////////////////////////////////////

        var nino = map.get("nino");
        var type = map.get("renewalType");
        var hasPartner = map.get("hasPartner");
        var posY = 0;
        var headerData = new Map();
        var introMap = new Map();

        var partnerHeader = "";
        var claimType = "";
        // Create journey based on renewal type.
        if (type == AUTO_RENEWAL) {
            renewalType = AUTO_RENEWAL;
        } else if (hasPartner == false || hasPartner == "false") {
            if (type == "D") {
                renewalType = SINGLE_D1;
            } else {
                renewalType = SINGLE_D2;
            }
            partnerHeader = "";
            claimType = "single";
        } else {
            if (type == "D") {
                renewalType = JOINT_D1;
            } else {
                renewalType = JOINT_D2;
            }
            partnerHeader = "or your partner ";
            claimType = "joint";
        }

        // Add content to map.
        map.set("PARTNER_DETAILS", partnerHeader);
        map.set("CLAIM_TYPE", claimType);

        // Set the renewalType.
        map.set("renewalType", renewalType);

        // NOTE: Based on the type of renewal drives how the questions are defined. The renewal type collects either 1
        // or 2 years worth of data for 1st and 2nd applicant.
        // The application defines two sets of questions which are SingleApplicant and JointApplicant. By default
        // SingleApplicant and JointApplicant define the PY (previous year) route. To collect the PY-1 questions, the
        // same set of SingleApplicant and JointApplicant questions are cloned, and the questions are transformed to collect PY-1 data.

        // The renewal type joint-d2 collects 2 years worth of data for both single and joint applicant. The questions are
        // generated from the steps below.
        //  1. Build initial set of questions from combining SingleApplicant and JointApplicant questions.
        //  2. Cycle through all questions and transform questions to collect PY-1 data. The question id's, routing and modelId attributes are updated to append PY_1.
        //  3. Append SingleApplicant and JointApplicant questions which represent PY data collection.
        //  4. The RoutingDecision questions are updated to wire the PY-1 and PY questions.


        // Build question journey based on the renewal type.
        if (renewalType !== undefined && renewalType.toUpperCase() == AUTO_RENEWAL) {

            ////////////////////////////////////////////////////////////////////////////////
            // AUTO RENEWAL
            ////////////////////////////////////////////////////////////////////////////////

            var autoRenewalJourney = {
                "formType":"AutoRenewal",
                "startQuestion":"a1",
                "CreationData":"12/12/2017:10:13",
                "questions": [
                    {
                        "id": "a1",
                        "question": "Do you need to report any changes to the details shown?",
                        "questionType": {
                          "type": "Boolean",
                          "questionHeaderDiv": "auto-renewal-header",
                          "yesInfoDiv": "auto-renewal-yes-info",
                          "yesNextQuestionId": "confirm-pack-receipt",
                          "noNextQuestionId": "a2", // End of journey.
                          "modelId": "renewalData.auto-renewal"
                        }
                    },
                    {
                        "id": "a2",
                        "question": "Renewal complete",
                        "questionType": {
                          "type": "JourneyCompleteAutoRenewal"
                        }
                    }
                ]
            };

            // Add singleApplicant questions to auto-renewal questions.
            autoRenewalJourney.questions = autoRenewalJourney.questions.concat(singleApplicant).concat(startQuestions);
            builtData=autoRenewalJourney;

            // Update question headers and update HTML div for 'Completing review message' DIV.
            headers_SINGLE_D1();

        } else if (renewalType !== undefined && renewalType.toUpperCase() == SINGLE_D1) {

            ////////////////////////////////////////////////////////////////////////////////
            // SINGLE D1 - single applicant
            ////////////////////////////////////////////////////////////////////////////////

            var singleApplicantJourney = {
                "formType":"SingleApplicant",
                "startQuestion":"confirm-pack-receipt",
                "CreationData":"12/12/2017:10:13",
                "questions": []
                };

            singleApplicantJourney.questions = singleApplicant.concat(startQuestions);;
            builtData=singleApplicantJourney;

            // Update question headers and update HTML div for 'Completing review message' DIV.
            headers_SINGLE_D1();

        } else if (renewalType !== undefined && renewalType.toUpperCase() == JOINT_D1) {

            ////////////////////////////////////////////////////////////////////////////////
            // Joint D1 - 1st applicant and 2nd applicant.
            ////////////////////////////////////////////////////////////////////////////////

            var jointApplicantJourney = {
                "formType":"SingleApplicant",
                "startQuestion": "confirm-pack-receipt",
                "CreationData":"12/12/2017:10:13",
                "questions": []
                };

            // Add singleApplicant questions to jointApplicantJourney.
            jointApplicantJourney.questions = jointApplicant.concat(singleApplicant).concat(startQuestions);
            builtData=jointApplicantJourney;

            // Update question headers and update HTML div for 'Completing review message' DIV.
            headers_JOINT_D1();

        } else if (renewalType !== undefined && renewalType.toUpperCase() == SINGLE_D2) {

            ///////////////////////////////////////////////////////
            // SINGLE D2 - 2 years single applicant
            ///////////////////////////////////////////////////////

            var single2YearsJourney = {
                "formType":"SingleApplicant2Years",
                "startQuestion": "confirm-pack-receipt",
                "CreationData":"12/12/2017:10:13",
                "questions": []
                };

            // Build PY-1 questions.
            single2YearsJourney.questions = JSON.parse(JSON.stringify(singleApplicant));
            updateQuestionsForPreviousYear(single2YearsJourney.questions);

            // Add PY questions.
            singleApplicant.forEach(function (question) {
                single2YearsJourney.questions.push(question);
            });
            // Add start questions.
            single2YearsJourney.questions = single2YearsJourney.questions.concat(startQuestions);

            // Rewire journeys single applicant to route to "Report any changes".
            builtData=single2YearsJourney

            // Override routing.
            updateRoutingForUntaxedBenefit(SINGLE_D2);
            updateRoutingForProfitSelfEmployment(SINGLE_D2);
            updateRoutingForHowMuchProfitSelfEmployment(SINGLE_D2);
            updateRoutingForPartnerAndBenefits(SINGLE_D2);
            updateRoutingForPartnerMakeProfitFromSelfEmployment(SINGLE_D2);
            updateRoutingForSelectOtherIncomeSources(SINGLE_D2);
            updateRoutingForDidMakeProfitFromPropertyRental(SINGLE_D2);

            var override = getQuestion("ROUTING DECISION COC");
            // Override the JOINT_D2_ROUTE and route to "Report any changes". 2nd (PY data) time the routing question is invoked will be on the PY path.
            override.questionType.JOINT_D2_ROUTE = "Report any changes";
            // re-wire start question to route to PY-1 question.
            override = getQuestion("Completing review message");
            override.questionType.nextQuestionId = "Benefits & Income - intro"+PREVIOUS_YEAR_MINUS_1;

            // Update question headers and update HTML div for 'Completing review message' DIV.
            headers_SINGLE_D2();

        } else if (renewalType !== undefined && renewalType.toUpperCase() == JOINT_D2) {

            ///////////////////////////////////////////////////////
            // JOINT D2 - 2 years + partner
            ///////////////////////////////////////////////////////

            var joint2YearsJourney = {
                "formType":"Joint D2",
                "startQuestion": "confirm-pack-receipt",
                "CreationData":"12/12/2017:10:13",
                "questions": []
                };

            // Add PY-1 1st applicant
            joint2YearsJourney.questions = JSON.parse(JSON.stringify(singleApplicant));
            // Add PY-1 2nd applicant
            var jointClone = JSON.parse(JSON.stringify(jointApplicant));
            jointClone.forEach(function (question) {
                joint2YearsJourney.questions.push(question);
            });
            // Override questions and add PY-1 id's to all question route ids.
            updateQuestionsForPreviousYear(joint2YearsJourney.questions);

            // Add PY 1st application journey to joint2YearsJourney.
            singleApplicant.forEach(function (question) {
                joint2YearsJourney.questions.push(question);
            });
            // Add PY 2nd applicant journey to joint2YearsJourney.
            jointApplicant.forEach(function (question) {
                joint2YearsJourney.questions.push(question);
            });
            // Add start questions.
            joint2YearsJourney.questions = joint2YearsJourney.questions.concat(startQuestions);

            builtData=joint2YearsJourney;

            // Override routing.
            updateRoutingForUntaxedBenefit(JOINT_D2);
            updateRoutingForProfitSelfEmployment(JOINT_D2);
            updateRoutingForHowMuchProfitSelfEmployment(JOINT_D2);
            updateRoutingForPartnerAndBenefits(JOINT_D2);
            updateRoutingForPartnerMakeProfitFromSelfEmployment(JOINT_D2);
            updateRoutingForSelectOtherIncomeSources(JOINT_D2);
            updateRoutingForDidMakeProfitFromPropertyRental(JOINT_D2);

            // Override routing. Route to partner benefits for previous year.
            var overrideA = getQuestion("ROUTING DECISION COC"+PREVIOUS_YEAR_MINUS_1);
            overrideA.questionType.JOINT_ROUTE = "Benefits & Income - intro";      // Route to 2nd year.

            var override = getQuestion("ROUTING DECISION COC");
            // Override the SINGLE_D2_ROUTE and route to "Report any changes". 2nd time the function is invoked will be on the PY path.
            override.questionType.JOINT_D2_ROUTE = "Report any changes";

            // re-wire start question to route to PY-1 question.
            override = getQuestion("Completing review message");
            override.questionType.nextQuestionId = "Benefits & Income - intro"+PREVIOUS_YEAR_MINUS_1;

            // Update question headers and update HTML div for 'Completing review message' DIV.
            headers_JOINT_D2();

        } else {
            throw(" Failed to resolve journey");
        }


// Uncomment to debug questions.
//        questionsDebugDump();

        return(builtData);
    }

    function updateRoutingForUntaxedBenefit(renewalType) {
        if (renewalType !== undefined && (renewalType.toUpperCase() == SINGLE_D2 || renewalType.toUpperCase() == JOINT_D2)) {
            // PY override
            var override = getQuestion("Benefits & Income - intro");
            override.questionType.nextQuestionId = "Were you employed";

            // PY-1 override.
            var overridePYminusOne = getQuestion("Benefits & Income - intro"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "Were you employed"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForProfitSelfEmployment(renewalType) {
        if (renewalType !== undefined && (renewalType.toUpperCase() == SINGLE_D2 || renewalType.toUpperCase() == JOINT_D2)) {
            // PY-1 override.
            var overridePYminusOne = getQuestion("Did you make a profit from self-employment"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.noNextQuestionId = "Did you get any taxable benefits"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForHowMuchProfitSelfEmployment(renewalType) {
        if (renewalType !== undefined && (renewalType.toUpperCase() == SINGLE_D2 || renewalType.toUpperCase() == JOINT_D2)) {
            // PY-1 override.
            var overridePYminusOne = getQuestion("How much profit from self-employment"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "Did you get any taxable benefits"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForPartnerAndBenefits(renewalType) {
        if (renewalType !== undefined && renewalType.toUpperCase() == JOINT_D2) {
            // PY and PY-1 override.
            var overridePY = getQuestion("Partner benefits & income intro");
            overridePY.questionType.nextQuestionId = "Was partner employed?";
            var overridePYminusOne = getQuestion("Partner benefits & income intro"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "Was partner employed?"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForPartnerMakeProfitFromSelfEmployment(renewalType) {
        if (renewalType !== undefined && renewalType.toUpperCase() == JOINT_D2) {
            // PY-1 override.
            var overridePYminusOne = getQuestion("Did partner make profit from self-employment?"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.noNextQuestionId = "Did partner get any taxable benefits?"+PREVIOUS_YEAR_MINUS_1;
            overridePYminusOne = getQuestion("How much profit did partner make from self-employment?"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "Did partner get any taxable benefits?"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForSelectOtherIncomeSources(renewalType) {
        if (renewalType !== undefined && (renewalType.toUpperCase() == SINGLE_D2 || renewalType.toUpperCase() == JOINT_D2)) {
            // PY-1 override.
            var overridePYminusOne = getQuestion("Select other income sources & enter amount"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "Did you get any income from property rental"+PREVIOUS_YEAR_MINUS_1;
        }
    }

    function updateRoutingForDidMakeProfitFromPropertyRental(renewalType) {
        if (renewalType !== undefined && (renewalType.toUpperCase() == SINGLE_D2 || renewalType.toUpperCase() == JOINT_D2)) {
            // PY-1 override.
            var overridePYminusOne = getQuestion("Did you make a profit from property rental"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.noNextQuestionId = "ROUTING DECISION COC"+PREVIOUS_YEAR_MINUS_1;

            overridePYminusOne = getQuestion("Property rental profit - enter amount"+PREVIOUS_YEAR_MINUS_1);
            overridePYminusOne.questionType.nextQuestionId = "ROUTING DECISION COC"+PREVIOUS_YEAR_MINUS_1;
        }
    }


    var PREVIOUS_YEAR_MINUS_1 = "_PY_1";

    function updateQuestionsForPreviousYear(questions) {

        function updateQuestionAnswerLinks(questionsToClear) {
            if (questionsToClear !== undefined && questionsToClear.questionIds !== undefined) {
                    var arrayLength = questionsToClear.questionIds.length;
                    // Cycle around associated checkbox input fields and check if ticked.
                    for (var i = 0; i < arrayLength; i++) {
                        questionsToClear.questionIds[i] += PREVIOUS_YEAR_MINUS_1;
                    }
            }
        }

        questions.forEach(function (question) {

            question.id += PREVIOUS_YEAR_MINUS_1;

            if (question.question !== undefined) {
                question.question = question.question.replace("[DATE_A]","[DATE_A"+PREVIOUS_YEAR_MINUS_1+"]");
                question.question = question.question.replace("[DATE_B]","[DATE_B"+PREVIOUS_YEAR_MINUS_1+"]");
            }

            if (question.group !== undefined) {
                question.group += PREVIOUS_YEAR_MINUS_1;
            }

            if (question.previousQuestionOption) {
                question.previousQuestionOption += PREVIOUS_YEAR_MINUS_1;
            }

            if (question.questionType.modelId !== undefined) {
                question.questionType.modelId += PREVIOUS_YEAR_MINUS_1;
            }

            if (question.questionType.type == "Boolean") {
                question.questionType.yesNextQuestionId += PREVIOUS_YEAR_MINUS_1;
                question.questionType.noNextQuestionId += PREVIOUS_YEAR_MINUS_1;

                updateQuestionAnswerLinks(question.questionType.answerNo);
                updateQuestionAnswerLinks(question.questionType.answerYes);

            } else if (question.questionType.type == "MultipleChoiceWithNumber" || question.questionType.type == "MultipleChoice") {
                var arrayLength = question.questionType.multipleChoiceOptions.length;
                // Cycle around associated checkbox input fields and check if ticked.
                for (var i = 0; i < arrayLength; i++) {
                    question.questionType.multipleChoiceOptions[i].modelId += PREVIOUS_YEAR_MINUS_1;
                }

              question.questionType.nextQuestionId += PREVIOUS_YEAR_MINUS_1;

            } else if (question.questionType.type == "RoutingDecision") {
                 question.questionType.JOINT_ROUTE += PREVIOUS_YEAR_MINUS_1;
                 question.questionType.OTHER_ROUTE += PREVIOUS_YEAR_MINUS_1;
            } else {
              question.questionType.nextQuestionId += PREVIOUS_YEAR_MINUS_1;
            }
        });
    }

</script>