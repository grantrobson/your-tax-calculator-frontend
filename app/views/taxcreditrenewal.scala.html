@(applicantType:String)(implicit request: Request[_], messages: Messages)

<style>
    p.one {
        border-style: solid;
        border-width: 5px;
    }

    h1.hidden {
        visibility: hidden;
    }
</style>


<script type="text/javascript">

// NOTE: The below JavaScript is a POC and is not production ready code.

    var map = new Map();

    function removeChildren() {
        var node = document.getElementById("containerDiv")
        while (node.hasChildNodes()) {
            node.removeChild(node.lastChild);
        }
    }

    function dynamicRadioButton() {
        var questionData = getFromId(questionPos);
        var arrayLength = questionData.questionType.multipleChoiceOptions.length;

        // Remove all child nodes.
        removeChildren();

        // Create child nodes based on current question.
        for (var i = 0; i < arrayLength; i++) {

            // create a radio button
            var radioButton = document.createElement("input");
            radioButton.setAttribute("type", "checkbox");
            // TODO. ID is not required and can be removed.
            radioButton.setAttribute("id", questionData.questionType.multipleChoiceOptions[i].modelId);
            radioButton.setAttribute("onClick", "toggleRadioButton(\""+questionData.questionType.multipleChoiceOptions[i].modelId+"\")");

            // Check if the Radio button was previously selected.
            if (map.get(questionData.questionType.multipleChoiceOptions[i].modelId) == "true") {
                radioButton.setAttribute("checked","checked");
            }

            // Create label for Radio Text.
            var label = document.createElement("label");
            label.innerHTML = questionData.questionType.multipleChoiceOptions[i].option;

            // add radio button to Div
            containerDiv.appendChild(radioButton);
            // add label text for radio button to Div
            containerDiv.appendChild(label);

            // add space between two radio buttons.
            var space = document.createElement("span");
            space.setAttribute("innerHTML", " &nbsp");
            containerDiv.appendChild(space);
        }

        return false;
    }
</script>

<script language=javascript type="text/javascript">
    var START_QUESTION = "1"
    var questionPos = START_QUESTION;
    var stack = [];
    var dynamicControls = ["Boolean", "MultipleChoice",  "Decimal"];

    function toggleControls(toggle) {
        dynamicControls.forEach((item) => {
            if (toggle == "show") show(item); else hide(item);
        });
    }

    function loadSelections(id) {
        toggleControls("hide");
        return;
    }

    function BACK() {
        if (stack.length == 0) {
            questionPos = START_QUESTION;
        } else {
            questionPos = stack.pop();
        }
        toggleControls("hide");
        displayQuestion();
    }

    // TODO...EXTEND ERROR HANDLING.
    function initialiseModel(model) {
        questionPos = START_QUESTION;
        var tokens = model.split(",");
        tokens.forEach(token => {
         var data = token.split(":");
         map.set(data[0],data[1]);
         });
        toggleControls("hide");
        displayQuestion();
    }

    function extractModelData() {
        var dumpData = "";
        var first = 1;
        var append = "";

        map.forEach((value, key) => {
            if (first == 1) {
                first=0;
                append="";
            } else {
                append=",";
            }
            dumpData = dumpData + append + key+":"+value;
        });

        // TODO...DEBUG ONLY
        var span = document.getElementById("dumpText"),
        text = document.createTextNode(dumpData);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);
    }

    function getFromId(id) {
        var arrayLength = data().questions.length;
        for (var i = 0; i < arrayLength; i++) {
            if (data().questions[i].id == id) {
                return data().questions[i];
                }
        }
        alert("FAILED TO FIND!!!");
    }

    function toggleRadioButton(id) {
        if (document.getElementById(id).checked == true) {
            map.set(id, "true");
        } else {
            map.set(id, "false");
        }
    }

    // TODO...ADD VALIDATION!!!
    function NEXT_DECIMAL() {
        stack.push(questionPos);
        var question = getFromId(questionPos);
        questionPos = question.questionType.nextQuestionId;

        var decimalInput = document.getElementById("DecimalInput").value;
        map.set(question.questionType.modelId, decimalInput+"");
        displayQuestion();
    }

    function NEXT(nextId) {
        stack.push(questionPos);
        var question = getFromId(questionPos);
        questionPos = question.questionType.nextQuestionId;
        displayQuestion();
    }

    function YES() {
        stack.push(questionPos);
        var question = getFromId(questionPos);

        if (question.questionType.modelId !== "undefined") {
            map.set(question.questionType.modelId, "true");
        }

        questionPos =  question.questionType.yesNextQuestionId;
        displayQuestion();
    }

    function NO() {
        stack.push(questionPos);
        var question = getFromId(questionPos);

        if (question.questionType.modelId !== "undefined") {
            map.set(question.questionType.modelId, "false");
        }

        questionPos =  question.questionType.noNextQuestionId;
        displayQuestion();
    }

    function startDemo() {
        toggleControls();
        hide("demo");
        displayQuestion();
    }

    function initQuestion(question, control, header) {
        document.getElementById(header).innerHTML = question.question;
        toggleControls("hide");
        show(control);
    }

    function displayQuestion() {
        var question = getFromId(questionPos);

        // DEBUG TRACE...TODO...
        var trace = "Question:"+questionPos+"-"+question.questionType.type
        var span = document.getElementById("QuestionId");
        var text = document.createTextNode(trace);
        span.innerHTML = ''; // clear existing
        span.appendChild(text);

        if (question.questionType.type == "Boolean") {
            initQuestion(question, 'Boolean', 'headerBoolean');
        } else if (question.questionType.type == "MultipleChoice") {
            initQuestion(question, 'MultipleChoice', 'headerMultipleChoice');
            dynamicRadioButton();
        } else if (question.questionType.type == "Decimal") {
            initQuestion(question, 'Decimal', 'headerDecimal');
            // Populate Decimal value from model if exists.
            var question = getFromId(questionPos);
            var decimalStore = map.get(question.questionType.modelId);
            if (decimalStore === undefined) {
                // Clear any previous entry in the field.
                document.getElementById('DecimalInput').value = ""
            }
            else if (decimalStore != "") {
                document.getElementById('DecimalInput').value = decimalStore;
            }

        } else {
            alert('Failed to resolve the question type ' + question.questionType.type);
        }
    }

    // TODO: Currently hardwired.
    function submissionAPI() {
        var submission = {
          "renewalData": {
            "incomeDetails": {
              "taxableBenefits": 10,
              "earnings": 20,
              "companyBenefits": 30,
              "seProfits": 40,
              "seProfitsEstimated": true
            },
            "incomeDetailsPY1": {
              "taxableBenefits": 10,
              "earnings": 20,
              "companyBenefits": 30,
              "seProfits": 40,
              "seProfitsEstimated": true
            },
            "certainBenefits": {
              "receivedBenefits": false,
              "incomeSupport": false,
              "jsa": false,
              "esa": false,
              "pensionCredit": false
            }
          },
          "otherIncome": {
            "otherHouseholdIncome": 100,
            "isOtherHouseholdIncomeEst": false
          },
          "otherIncomePY1": {
            "otherHouseholdIncome": 100,
            "isOtherHouseholdIncomeEst": false
          },
          "hasChangeOfCircs": false
        }
        return(submission);
    }


    // TODO: Align with BA document. Below is an example to demo the framework.
    function data() {
        var myObj = {
            "formType":"JointApplicant",

            "CreationData":"12/12/2017:10:13",

            "questions": [
                  {
                    "id": "1",
                    "question": "Did you get any of these benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "2",
                      "noNextQuestionId": "3",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "2",
                    "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "3"
                    }
                  },
                  {
                    "id": "3",
                    "question": "Did your partner get any of these benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "4",
                      "noNextQuestionId": "5",
                      "modelId": "renewalData.certainBenefits.receivedBenefits" // TODO...DUPLICATE!
                    }
                  },
                  {
                    "id": "4",
                    "question": "Which of these benefits did your partner get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport-TODO-4"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance TODO 4",
                          "modelId": "renewalData.certainBenefits.jsa.TODO-4"
                        }
                      ],
                      "nextQuestionId": "5"
                    }
                  },
                  {
                    "id": "5",
                    "question": "Did you get any of these other benefits at the time between 6 April 2014 to 5 April 2015 ? \n\r - Other Income Support \n\r - Other Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "6",
                      "noNextQuestionId": "7"
                    }
                  },
                  {
                    "id": "6",
                    "question": "Which of these benefits did you get at the time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                //      "type": "MultipleChoiceWithNumber",  TODO...DEFINE THE INPUT TYPE!
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Other Income Support",
                          "modelId": "otherBenefits.OtherIncome"
                        },
                        {
                          "option": "Other Income-based Jobseeker's Allowance",
                          "modelId": "otherBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "7"
                    }
                  },
                  {
                    "id": "7",
                    "question": "Were you employed at any time between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "8",
                      "noNextQuestionId": "10"
                      // TODO...NO MODELID!!! IF THIS IS UNDEFINED?
                    }
                  },
                  {
                    "id": "8",
                    "question": "How much did you earn from all of your jobs as an employee between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "9",
                      "modelId": "otherIncome.otherHouseholdIncome"
                    }
                  },
                  {
                    "id": "9",
                    "question": "How much did you receive in company benefits between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "Some more info on what this question is",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "10",
                      "modelId": "TODO-QUESTION-9"
                    }
                  },
                  {
                    "id": "10",
                    "question": "Were you self employed at any time between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "This does not include renting out property or a room in your home.",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "11",
                      "noNextQuestionId": "12"
                      // TODO...IF NO MODEL ID THEN DO NOT STORE!
                    }
                  },
                  {
                    "id": "11",
                    "question": "How much self-employed profit did you make between 6 April 2014 to 5 April 2015?",
                    "additionalInformation": "If you made a loss, enter zero (eg, 0)",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "12",
                      // TODO...SORT THIS OUT!!!
                      "allowEstimate": true,
                      "modelId": "otherIncome.selfEmployedProfit",
                      "estimateModelId": "otherIncome.isSelfEmployedProfitEst"
                    }
                  },
                  {
                    "id": "12",
                    "question": "Did you get any of these taxable benefits at the time between 6 April 2014 to 5 April 2015? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "13",
                      "noNextQuestionId": "14"
                    }
                  },
                  {
                    "id": "13",
                    "question": "How much did you receive for all your taxable benefits between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "14",
                    "modelId": "TODO_Q-14"
                    }
                  },
                  {
                    "id": "14",
                    "question": "Did your partner get any of these taxable benefits at the time between 6 April 2014 to 5 April 2015? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "15",
                      "noNextQuestionId": "16"
                    }
                  },
                  {
                    "id": "15",
                    "question": "How much did your partner receive for all your taxable benefits between 6 April 2014 to 5 April 2015?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "16",
                      "modelId": "TODO_Q-15"
                    }
                  },
                  {
                    "id": "16",
                    "question": "Did you get any of these benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "17",
                      "noNextQuestionId": "18",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "17",
                    "question": "Which of these benefits did you get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "18"
                    }
                  },
                  {
                    "id": "18",
                    "question": "Did your partner get any of these benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Income Support \n\r - Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "19",
                      "noNextQuestionId": "20",
                      "modelId": "renewalData.certainBenefits.receivedBenefits"
                    }
                  },
                  {
                    "id": "19",
                    "question": "Which of these benefits did your partner get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                      "multipleChoiceOptions": [
                        {
                          "option": "Income Support",
                          "modelId": "renewalData.certainBenefits.incomeSupport"
                        },
                        {
                          "option": "Income-based Jobseeker's Allowance",
                          "modelId": "renewalData.certainBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "20"
                    }
                  },
                  {
                    "id": "20",
                    "question": "Did you get any of these other benefits at the time between 6 April 2015 to 5 April 2016 ? \n\r - Other Income Support \n\r - Other Income - based Jobseeker's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "21",
                      "noNextQuestionId": "22"
                    }
                  },
                  {
                    "id": "21",
                    "question": "Which of these benefits did you get at the time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "MultipleChoice",
                //      "type": "MultipleChoiceWithNumber", TODO
                      "multipleChoiceOptions": [
                        {
                          "option": "Other Income Support",
                          "modelId": "otherBenefits.OtherIncome"
                        },
                        {
                          "option": "Other Income-based Jobseeker's Allowance",
                          "modelId": "otherBenefits.jsa"
                        }
                      ],
                      "nextQuestionId": "22"
                    }
                  },
                  {
                    "id": "22",
                    "question": "Were you employed at any time between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "23",
                      "noNextQuestionId": "25"
                    }
                  },
                  {
                    "id": "23",
                    "question": "How much did you earn from all of your jobs as an employee between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "24",
                      "modelId": "otherIncome.otherHouseholdIncome_TODO_DUPLICATE"
                    }
                  },
                  {
                    "id": "24",
                    "question": "How much did you receive in company benefits between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "Some more info on what this quesiton is",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "25",
                      "modelId": "TODO.QUESTION.25"
                    }
                  },
                  {
                    "id": "25",
                    "question": "Were you self employed at any time between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "This does not include renting out property or a room in your home.",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "26",
                      "noNextQuestionId": "27"
                    }
                  },
                  {
                    "id": "26",
                    "question": "How much self-employed profit did you make between 6 April 2015 to 5 April 2016?",
                    "additionalInformation": "If you made a loss, enter zero (eg, 0)",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "27",
                      "allowEstimate": true,
                      "modelId": "otherIncome.selfEmployedProfit_TODO_DUPLICATE",
                      "estimateModelId": "otherIncome.isSelfEmployedProfitEst"
                    }
                  },
                  {
                    "id": "27",
                    "question": "Did you get any of these taxable benefits at the time between 6 April 2015 to 5 April 2016? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      // TODO...NO MODEL ID!!! IF NO ID THEN STORE NOTHING!!!
                      "type": "Boolean",
                      "yesNextQuestionId": "28",
                      "noNextQuestionId": "29"
                    }
                  },
                  {
                    "id": "28",
                    "question": "How much did you receive for all your taxable benefits between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "29",
                      "modelId": "TODO.QUESTION.29"
                    }
                  },
                  {
                    "id": "29",
                    "question": "Did your partner get any of these taxable benefits at the time between 6 April 2015 to 5 April 2016? \n\r - Bereavement Allowance \n\r - Carer's Allowance",
                    "questionType": {
                      "type": "Boolean",
                      "yesNextQuestionId": "30",
                      "noNextQuestionId": "31"
                    }
                  },
                  {
                    "id": "30",
                    "question": "How much did your partner receive for all your taxable benefits between 6 April 2015 to 5 April 2016?",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "31",
                      "modelId": "TODO.QUESTION.31"
                    }
                  },
                    {
                    "id": "31",
                    "question": "The end of the demo screens - Pressing Next will route round to Question 1",
                    "questionType": {
                      "type": "Decimal",
                      "nextQuestionId": "1",
                      "modelId": "TODO.QUESTION.31"
                    }
                  }

                ]
            }

        return(myObj);
    }
</script>

<script type="text/javascript">

   function hide(id) {
       var e = document.getElementById(id);
        e.style.display = 'none';
   }

   function show(id) {
       var e = document.getElementById(id);
            e.style.display = 'block';
   }

</script>


@main_template(title = "Tax-Credit-Renewal POC JavaScript Application", bodyClasses = None) {

<h1>Tax-Credit-Renewal POC JavaScript Application</h1>

<!-- MultipleChoice -->
<div id="MultipleChoice" style="display: none;">
    <p id="headerMultipleChoice"></p>
    <div>
        <div id="containerDiv"></div>
    </div>
    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="NEXT" onClick="javascript:NEXT()">
</div>

<!-- Boolean -->
<div id="Boolean" style="display: none;">
    <p id="headerBoolean"></p>
    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="YES" onClick="javascript:YES()">
    <input type="button" value="NO" onClick="javascript:NO()">
</div>

<!-- Decimal Input -->
<div id="Decimal" style="display: none;">
    <p id="headerDecimal"></p>
    <input type="number" id="DecimalInput">
    <br>
    <input type="button" value="BACK" onClick="javascript:BACK()">
    <input type="button" value="NEXT" onClick="javascript:NEXT_DECIMAL()">
</div>


<div id="demo">
    <input type="button" value="Start Demo" onClick="javascript:startDemo()">
</div>

<br>
<br>


<p class="one">Tools - Please note below section is only for demo purposes.</p>
<br>
<div id="Question Debug Trace">
    <b><span>Question Details</span></b>
    <br>
    <span id="QuestionId"></span>
</div>
<br>


<input type="button" value="Initialise model" onClick="javascript:initialiseModel('renewalData.certainBenefits.incomeSupport:true,otherIncome.otherHouseholdIncome:1234.54')">
<input type="button" value="Extract Model" onClick="javascript:extractModelData()">
<div id="dumpDiv">
    <b><span>Model Dump</span></b>
    <br><br>
    <span id="dumpText"></span>
</div>

}


